# =============================================================================
# Harbor Registry Secret
# =============================================================================
# This secret allows Kubernetes to authenticate with the private Harbor registry
# to pull container images.
#
# IMPORTANT: This is a TEMPLATE file. You need to create the actual secret
# using kubectl with your Harbor credentials.
# =============================================================================
#
# Option 1: Create secret using kubectl (RECOMMENDED)
# ====================================================
# Run this command to create the secret:
#
#   kubectl create secret docker-registry harbor-registry-secret \
#     --docker-server=134.209.232.225:8080 \
#     --docker-username=YOUR_HARBOR_USERNAME \
#     --docker-password=YOUR_HARBOR_PASSWORD \
#     --docker-email=YOUR_EMAIL
#
# Option 2: Create secret from existing Docker config
# ====================================================
# If you've already logged into Harbor with Docker:
#
#   docker login 134.209.232.225:8080
#   kubectl create secret generic harbor-registry-secret \
#     --from-file=.dockerconfigjson=$HOME/.docker/config.json \
#     --type=kubernetes.io/dockerconfigjson
#
# Option 3: Apply this YAML file with base64-encoded credentials
# ===============================================================
# Generate the base64-encoded dockerconfigjson:
#
#   echo -n '{"auths":{"134.209.232.225:8080":{"username":"YOUR_USERNAME","password":"YOUR_PASSWORD","auth":"BASE64_OF_USERNAME:PASSWORD"}}}' | base64
#
# Then replace <BASE64_ENCODED_DOCKER_CONFIG> below and apply:
#
#   kubectl apply -f harbor-registry-secret.yaml
#
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  # Name must match imagePullSecrets in deployment.yaml
  name: harbor-registry-secret
  labels:
    app: myapi
# Type for Docker registry authentication
type: kubernetes.io/dockerconfigjson
data:
  # Replace this with your base64-encoded Docker config JSON
  # Generate it using the instructions above
  .dockerconfigjson: <BASE64_ENCODED_DOCKER_CONFIG>
# =============================================================================
# INSECURE REGISTRY CONFIGURATION
# =============================================================================
# Since Harbor is running on HTTP (port 8080, not HTTPS), you MUST configure
# each Kubernetes node to trust this insecure registry.
#
# For containerd (default in modern Kubernetes):
# ----------------------------------------------
# Edit /etc/containerd/config.toml on EACH node and add:
#
#   [plugins."io.containerd.grpc.v1.cri".registry.configs."134.209.232.225:8080".tls]
#     insecure_skip_verify = true
#
#   [plugins."io.containerd.grpc.v1.cri".registry.mirrors."134.209.232.225:8080"]
#     endpoint = ["http://134.209.232.225:8080"]
#
# Then restart containerd:
#   sudo systemctl restart containerd
#
# For Docker (if using Docker as container runtime):
# ---------------------------------------------------
# Edit /etc/docker/daemon.json on EACH node:
#
#   {
#     "insecure-registries": ["134.209.232.225:8080"]
#   }
#
# Then restart Docker:
#   sudo systemctl restart docker
#
# For minikube:
# -------------
#   minikube start --insecure-registry="134.209.232.225:8080"
#
# For k3s:
# --------
# Create /etc/rancher/k3s/registries.yaml:
#
#   mirrors:
#     "134.209.232.225:8080":
#       endpoint:
#         - "http://134.209.232.225:8080"
#
# Then restart k3s:
#   sudo systemctl restart k3s
#
# =============================================================================
